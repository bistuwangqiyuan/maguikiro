# 需求文档 - 接触式磁检测仪器软件

## 简介

本项目旨在开发一个高端工业级的接触式磁检测仪器Web应用程序，复现DOPPLER品牌磁检测设备的界面和功能。该系统将提供专业的磁信号检测、数据采集、实时波形显示、数据分析和报告生成等功能，符合国际无损检测标准（如ASME、ISO、EN等）。

系统采用现代化的前端技术栈，后端完全基于Supabase实现，无需独立后端代码，确保开发效率和维护便利性。

## 需求

### 需求 1: 工业级仪器界面设计

**用户故事:** 作为检测工程师，我希望看到一个高度还原的工业级仪器界面，以便获得专业、可靠的使用体验。

#### 验收标准

1. WHEN 用户打开应用 THEN 系统应显示带有橙色和黑色工业配色的仪器外壳界面
2. WHEN 界面加载完成 THEN 系统应展示左侧功能按钮区（播放、暂停、DISP、主菜单、GATE、VPA等）
3. WHEN 界面渲染 THEN 系统应在右侧显示操作按钮（返回、SAVE、MENU、旋钮等）
4. WHEN 用户查看界面 THEN 系统应在顶部显示DOPPLER品牌标识和设备型号
5. WHEN 界面布局完成 THEN 系统应确保所有UI元素具有工业设备的质感和专业感

### 需求 2: 实时磁信号波形显示

**用户故事:** 作为检测工程师，我希望实时查看磁信号波形图，以便监测和分析材料缺陷。

#### 验收标准

1. WHEN 检测开始 THEN 系统应在主显示区域实时绘制磁信号波形
2. WHEN 信号数据更新 THEN 系统应以至少30fps的刷新率更新波形显示
3. WHEN 波形显示 THEN 系统应包含网格线、刻度标记和单位标注
4. WHEN 检测到异常信号 THEN 系统应在波形上高亮显示缺陷位置
5. IF 信号幅值超过阈值 THEN 系统应触发报警标记
6. WHEN 用户调整增益 THEN 系统应实时更新波形的垂直缩放比例

### 需求 3: 检测参数配置

**用户故事:** 作为检测工程师，我希望能够配置各种检测参数，以便适应不同的检测场景和标准要求。

#### 验收标准

1. WHEN 用户点击参数设置 THEN 系统应显示参数配置面板
2. WHEN 配置面板打开 THEN 系统应提供增益(Gain)、滤波器(Filter)、门限(Gate)、速度(Velocity)等参数设置
3. WHEN 用户修改参数 THEN 系统应实时验证参数的有效性范围
4. WHEN 参数保存 THEN 系统应将配置存储到Supabase数据库
5. IF 参数超出安全范围 THEN 系统应显示警告并阻止保存
6. WHEN 用户选择预设模式 THEN 系统应自动加载符合国际标准的参数组合

### 需求 4: 数据采集与存储

**用户故事:** 作为检测工程师，我希望系统能够自动采集和存储检测数据，以便后续分析和报告生成。

#### 验收标准

1. WHEN 检测开始 THEN 系统应开始记录时间戳、信号幅值、位置信息等数据
2. WHEN 数据采集进行中 THEN 系统应每秒至少采集100个数据点
3. WHEN 数据达到缓冲区阈值 THEN 系统应自动批量写入Supabase数据库
4. WHEN 检测完成 THEN 系统应生成唯一的检测记录ID
5. IF 网络连接中断 THEN 系统应在本地缓存数据并在恢复后自动同步
6. WHEN 用户查询历史数据 THEN 系统应能够从数据库检索并展示完整的检测记录

### 需求 5: 多页面导航系统

**用户故事:** 作为检测工程师，我希望能够在不同功能页面之间流畅切换，以便完成完整的检测工作流程。

#### 验收标准

1. WHEN 用户点击菜单按钮 THEN 系统应显示主导航菜单
2. WHEN 导航菜单显示 THEN 系统应包含以下页面：文件管理、切位置、图像显示、阈值设置、闸门设置、系统设置、全屏模式、校准、帮助、关于
3. WHEN 用户选择页面 THEN 系统应平滑过渡到目标页面
4. WHEN 页面切换 THEN 系统应保持当前检测状态不中断
5. WHEN 用户在子页面 THEN 系统应显示面包屑导航或返回按钮

### 需求 6: 数据表格显示

**用户故事:** 作为检测工程师，我希望以表格形式查看检测数据，以便快速浏览和比较多个测量点的结果。

#### 验收标准

1. WHEN 用户打开数据表格页面 THEN 系统应显示包含序号、位置、幅值、相位、状态等列的数据表
2. WHEN 表格加载 THEN 系统应从Supabase数据库获取最新的检测记录
3. WHEN 用户点击表头 THEN 系统应支持按该列排序
4. WHEN 用户选择某行数据 THEN 系统应高亮显示并允许查看详细信息
5. WHEN 数据超过一页 THEN 系统应提供分页控件
6. IF 检测到缺陷 THEN 系统应在表格中用不同颜色标记异常数据行

### 需求 7: 闸门(Gate)设置功能

**用户故事:** 作为检测工程师，我希望设置检测闸门参数，以便精确控制信号采集的时间窗口和幅值范围。

#### 验收标准

1. WHEN 用户打开闸门设置 THEN 系统应显示闸门A和闸门B的配置界面
2. WHEN 配置闸门 THEN 系统应允许设置起始位置、宽度、高度、报警阈值
3. WHEN 闸门参数改变 THEN 系统应在波形图上实时显示闸门的可视化边界
4. WHEN 信号进入闸门范围 THEN 系统应触发数据采集
5. IF 信号幅值超过闸门报警线 THEN 系统应记录缺陷并发出警报
6. WHEN 用户保存闸门设置 THEN 系统应将配置存储到数据库并应用到当前检测

### 需求 8: 系统校准功能

**用户故事:** 作为检测工程师，我希望对仪器进行校准，以便确保测量结果的准确性和符合标准要求。

#### 验收标准

1. WHEN 用户进入校准页面 THEN 系统应显示校准向导界面
2. WHEN 校准开始 THEN 系统应引导用户放置标准试块
3. WHEN 用户确认试块就位 THEN 系统应采集参考信号
4. WHEN 参考信号采集完成 THEN 系统应计算校准系数并显示结果
5. IF 校准偏差超过允许范围 THEN 系统应提示重新校准
6. WHEN 校准成功 THEN 系统应保存校准数据到数据库并记录校准时间和操作员信息

### 需求 9: 检测报告生成

**用户故事:** 作为检测工程师，我希望自动生成符合标准的检测报告，以便提交给客户或存档。

#### 验收标准

1. WHEN 用户点击生成报告 THEN 系统应收集当前检测的所有相关数据
2. WHEN 报告生成 THEN 系统应包含项目信息、检测参数、波形图、数据表格、缺陷统计、结论等部分
3. WHEN 报告内容组织完成 THEN 系统应提供PDF导出功能
4. WHEN 用户选择报告模板 THEN 系统应支持ASME、ISO等国际标准格式
5. WHEN 报告保存 THEN 系统应将报告元数据存储到Supabase数据库
6. IF 检测到关键缺陷 THEN 系统应在报告中自动标注并提供建议

### 需求 10: 历史记录管理

**用户故事:** 作为检测工程师，我希望查看和管理历史检测记录，以便进行趋势分析和质量追溯。

#### 验收标准

1. WHEN 用户打开历史记录页面 THEN 系统应显示所有检测记录的列表
2. WHEN 记录列表加载 THEN 系统应从Supabase数据库查询并显示日期、项目名称、操作员、状态等信息
3. WHEN 用户选择某条记录 THEN 系统应加载并显示完整的检测数据和波形
4. WHEN 用户搜索记录 THEN 系统应支持按日期范围、项目名称、操作员等条件筛选
5. WHEN 用户删除记录 THEN 系统应要求确认并软删除数据（标记为已删除而非物理删除）
6. WHEN 用户导出记录 THEN 系统应支持批量导出为CSV或Excel格式

### 需求 11: 用户认证与权限管理

**用户故事:** 作为系统管理员，我希望管理用户账户和权限，以便确保数据安全和操作规范。

#### 验收标准

1. WHEN 用户首次访问系统 THEN 系统应显示登录页面
2. WHEN 用户输入凭证 THEN 系统应通过Supabase Auth验证身份
3. WHEN 登录成功 THEN 系统应根据用户角色加载相应的功能权限
4. IF 用户角色为操作员 THEN 系统应限制访问系统设置和用户管理功能
5. IF 用户角色为管理员 THEN 系统应允许访问所有功能和管理界面
6. WHEN 用户会话超时 THEN 系统应自动登出并保存当前工作状态

### 需求 12: 实时数据监控仪表盘

**用户故事:** 作为检测工程师，我希望在仪表盘上查看关键指标，以便快速了解检测状态和设备健康度。

#### 验收标准

1. WHEN 用户打开仪表盘 THEN 系统应显示当前检测速度、信号强度、缺陷计数、检测进度等指标
2. WHEN 指标数据更新 THEN 系统应实时刷新仪表盘显示
3. WHEN 仪表盘显示 THEN 系统应使用仪表、进度条、数字显示等多种可视化方式
4. IF 任何指标异常 THEN 系统应在仪表盘上显示警告图标
5. WHEN 用户点击指标 THEN 系统应显示该指标的历史趋势图
6. WHEN 检测完成 THEN 系统应在仪表盘上显示检测总结和质量评分

### 需求 13: 响应式设计与跨设备支持

**用户故事:** 作为检测工程师，我希望在不同设备上使用系统，以便在现场和办公室都能方便地工作。

#### 验收标准

1. WHEN 用户在桌面浏览器访问 THEN 系统应显示完整的仪器界面布局
2. WHEN 用户在平板设备访问 THEN 系统应自动调整布局以适应屏幕尺寸
3. WHEN 用户在移动设备访问 THEN 系统应提供简化的移动版界面
4. WHEN 屏幕方向改变 THEN 系统应重新布局以优化显示
5. WHEN 用户使用触摸屏 THEN 系统应支持触摸手势操作（缩放、滑动等）
6. IF 设备性能较低 THEN 系统应自动降低波形刷新率以保证流畅性

### 需求 14: 数据导出与集成

**用户故事:** 作为检测工程师，我希望导出数据到其他系统，以便与现有的质量管理流程集成。

#### 验收标准

1. WHEN 用户选择导出功能 THEN 系统应提供多种格式选项（CSV、Excel、JSON、PDF）
2. WHEN 用户选择CSV格式 THEN 系统应导出包含所有数据点的原始数据文件
3. WHEN 用户选择Excel格式 THEN 系统应生成包含图表和格式化表格的工作簿
4. WHEN 用户选择JSON格式 THEN 系统应导出结构化的API友好数据
5. WHEN 导出完成 THEN 系统应提供下载链接或自动触发浏览器下载
6. IF 数据量较大 THEN 系统应在后台处理并通过邮件发送下载链接

### 需求 15: 离线模式支持

**用户故事:** 作为检测工程师，我希望在网络不稳定的现场环境中也能使用系统，以便不中断检测工作。

#### 验收标准

1. WHEN 应用首次加载 THEN 系统应缓存核心资源到浏览器
2. WHEN 网络连接断开 THEN 系统应自动切换到离线模式并显示提示
3. WHEN 在离线模式下检测 THEN 系统应将数据存储到本地IndexedDB
4. WHEN 网络恢复 THEN 系统应自动同步本地数据到Supabase数据库
5. IF 同步冲突发生 THEN 系统应提示用户选择保留哪个版本的数据
6. WHEN 离线数据同步完成 THEN 系统应显示同步成功通知并清理本地缓存
