# 实施计划 - 接触式磁检测仪器软件

- [-] 1. 项目初始化和基础配置








  - 使用Vite创建SvelteKit项目，配置TypeScript支持
  - 安装核心依赖：Tailwind CSS、DaisyUI、Chart.js、Supabase客户端
  - 配置Tailwind和DaisyUI，设置工业风格主题色（橙色+黑色）
  - 创建环境变量文件，配置Supabase连接信息
  - 设置项目目录结构（components、services、stores、utils、types）
  - _需求: 1.1, 1.2, 1.3_


- [ ] 2. Supabase数据库设置

  - 创建profiles表并设置RLS策略
  - 创建testing_sessions表，包含索引和RLS策略
  - 创建signal_data表，优化查询性能
  - 创建defects表，设置级联删除
  - 创建calibrations表，管理校准记录
  - 创建reports表，存储报告元数据
  - 配置Supabase Storage bucket用于PDF文件存储
  - _需求: 4.1, 4.2, 4.3, 4.4, 11.1, 11.2_



- [ ] 3. 类型定义和接口
  - 定义SignalData、TestingSession、TestingParameters接口
  - 定义GateConfig、Defect、CalibrationData接口
  - 定义数据库表对应的TypeScript类型
  - 创建枚举类型（状态、角色、严重程度等）
  - _需求: 2.1, 3.1, 7.1_

- [ ] 4. Supabase客户端封装

  - 创建Supabase客户端单例
  - 实现会话管理服务（CRUD操作）
  - 实现信号数据批量写入服务
  - 实现缺陷记录服务
  - 实现校准数据服务
  - 实现报告管理服务
  - _需求: 4.1, 4.2, 4.3, 8.4, 9.5_


- [ ] 5. 用户认证系统
  - 创建登录页面组件
  - 实现Supabase Auth登录逻辑
  - 创建认证状态Store
  - 实现路由守卫，保护需要认证的页面
  - 创建用户角色权限检查工具函数
  - 实现会话超时自动登出
  - _需求: 11.1, 11.2, 11.3, 11.4, 11.5, 11.6_


- [ ] 6. 工业级仪器外壳界面
  - 创建InstrumentShell组件，实现橙色边框和黑色主体
  - 创建LeftPanel组件，包含播放、暂停、DISP、主菜单、GATE、VPA按钮
  - 创建RightPanel组件，包含返回、SAVE、MENU按钮和旋钮
  - 创建TopBar组件，显示DOPPLER品牌和状态信息
  - 创建MainDisplay组件作为内容容器
  - 应用工业风格CSS（金属质感、阴影、渐变）
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5_


- [ ] 7. 信号生成和数据采集服务

  - 实现SignalGenerator类，生成基础正弦波信号
  - 实现缺陷信号生成算法（高斯脉冲）
  - 实现信号叠加逻辑，组合基础信号和缺陷信号
  - 创建DataAcquisitionService，管理数据采集循环
  - 实现可配置的采样率（默认100Hz）
  - 添加噪声模拟，增加真实感
  - _需求: 2.1, 4.1, 4.2_

- [ ] 8. 信号处理服务
  - 实现增益调整算法
  - 实现滤波器（低通、高通、带通）
  - 实现相位计算
  - 实现缺陷检测算法（阈值比较）
  - 创建信号处理管道，链式处理数据
  - _需求: 2.1, 2.6, 3.1, 3.3_

- [ ] 9. 检测状态管理Store
  - 创建testingStore，管理当前检测会话状态
  - 实现开始、暂停、停止检测的actions
  - 管理实时信号数据缓冲区
  - 实现缺陷列表管理
  - 添加检测进度跟踪
  - _需求: 2.1, 4.1, 12.1_

- [ ] 10. 实时波形图表组件
  - 使用Chart.js创建WaveformChart组件
  - 配置实时数据流插件（chartjs-plugin-streaming）
  - 实现网格线、刻度和单位标注
  - 设置波形颜色为绿色（#00FF00）
  - 实现自动滚动和缩放功能
  - 优化渲染性能，使用Canvas而非SVG
  - _需求: 2.1, 2.2, 2.3, 2.6_

- [ ] 11. 闸门可视化覆盖层
  - 创建GateOverlay组件，在波形图上绘制闸门
  - 实现闸门A和闸门B的矩形边界显示
  - 使用不同颜色区分两个闸门（金色和粉色）
  - 实现闸门位置和大小的实时更新
  - 添加闸门报警线显示
  - _需求: 2.4, 7.3_

- [ ] 12. 缺陷标记组件
  - 创建SignalMarker组件，在波形上标记缺陷位置
  - 根据缺陷严重程度使用不同颜色
  - 实现点击标记查看缺陷详情
  - 添加缺陷计数显示
  - _需求: 2.4, 2.5, 6.6_

- [ ] 13. 参数设置面板
  - 创建ParameterPanel组件
  - 实现增益滑块控件（0-100dB）
  - 实现滤波器选择下拉框
  - 实现速度输入框
  - 实现阈值设置滑块
  - 添加参数实时验证
  - 实现参数保存到数据库
  - _需求: 3.1, 3.2, 3.3, 3.4, 3.5_

- [ ] 14. 闸门设置页面
  - 创建GateSettings组件
  - 实现闸门A和闸门B的独立配置区域
  - 添加起始位置、宽度、高度、报警阈值输入框
  - 实现闸门启用/禁用开关
  - 添加颜色选择器
  - 实现设置保存和应用
  - _需求: 7.1, 7.2, 7.3, 7.4, 7.5, 7.6_

- [ ] 15. 数据表格显示
  - 创建DataTable组件，显示检测数据
  - 实现表头（序号、位置、幅值、相位、状态）
  - 从Supabase加载数据
  - 实现表头点击排序功能
  - 实现行选择和高亮
  - 添加分页控件
  - 使用颜色标记异常数据行
  - _需求: 6.1, 6.2, 6.3, 6.4, 6.5, 6.6_

- [ ] 16. 主导航菜单
  - 创建NavigationMenu组件
  - 实现菜单按钮触发显示/隐藏
  - 添加菜单项：文件管理、切位置、图像显示、阈值设置、闸门设置、系统设置、全屏模式、校准、帮助、关于
  - 实现菜单项点击导航到对应页面
  - 添加平滑过渡动画
  - _需求: 5.1, 5.2, 5.3_

- [ ] 17. 页面路由和布局
  - 创建根布局（+layout.svelte），包含仪器外壳
  - 创建主页（+page.svelte），显示波形和数据表格
  - 创建仪表盘页面（dashboard/+page.svelte）
  - 创建历史记录页面（history/+page.svelte）
  - 创建系统设置页面（settings/+page.svelte）
  - 创建校准页面（calibration/+page.svelte）
  - 创建报告页面（reports/+page.svelte）
  - 实现页面切换时保持检测状态
  - _需求: 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 18. 实时数据监控仪表盘
  - 创建Dashboard页面组件
  - 创建Gauge组件，显示检测速度和信号强度
  - 创建ProgressBar组件，显示检测进度
  - 创建StatusIndicator组件，显示设备状态
  - 实现缺陷计数卡片
  - 实现质量评分显示
  - 添加异常警告图标
  - _需求: 12.1, 12.2, 12.3, 12.4, 12.5, 12.6_

- [ ] 19. 校准功能实现
  - 创建CalibrationWizard组件，引导用户完成校准
  - 实现步骤1：提示放置标准试块
  - 实现步骤2：采集参考信号
  - 实现步骤3：计算校准系数
  - 实现步骤4：显示校准结果
  - 实现校准偏差检查和重新校准提示
  - 保存校准数据到数据库，记录时间和操作员
  - _需求: 8.1, 8.2, 8.3, 8.4, 8.5, 8.6_

- [ ] 20. 国际标准预设参数
  - 创建标准参数配置文件（ASME、ISO、EN、ASTM）
  - 实现预设参数加载功能
  - 在参数设置面板添加标准选择下拉框
  - 实现选择标准后自动应用参数
  - 添加标准说明和参考文档链接
  - _需求: 3.6_

- [ ] 21. 报告生成服务
  - 安装jsPDF和html2canvas库
  - 创建ReportGenerator类
  - 实现报告头部生成（项目信息、日期、操作员）
  - 实现参数表格生成
  - 实现波形图截图和插入
  - 实现数据表格生成
  - 实现缺陷统计和结论生成
  - _需求: 9.1, 9.2, 9.3_

- [ ] 22. 报告模板系统
  - 创建ASME标准报告模板
  - 创建ISO标准报告模板
  - 创建EN标准报告模板
  - 实现模板选择功能
  - 实现模板变量替换
  - 添加公司Logo和签名区域
  - _需求: 9.4_

- [ ] 23. 报告导出和存储
  - 实现PDF导出功能，触发浏览器下载
  - 实现PDF上传到Supabase Storage
  - 保存报告元数据到reports表
  - 实现报告列表查看
  - 实现报告下载和分享
  - _需求: 9.2, 9.5, 9.6_

- [ ] 24. 历史记录管理
  - 创建History页面组件
  - 从Supabase查询所有检测会话
  - 显示会话列表（日期、项目名称、操作员、状态）
  - 实现会话选择和详情查看
  - 加载并显示历史波形和数据
  - 实现搜索和筛选功能（日期范围、项目名称、操作员）
  - 实现软删除功能（标记为已删除）
  - _需求: 10.1, 10.2, 10.3, 10.4, 10.5_

- [ ] 25. 数据导出功能
  - 创建DataExporter工具类
  - 实现CSV格式导出（原始数据）
  - 实现Excel格式导出（使用SheetJS）
  - 实现JSON格式导出
  - 在历史记录页面添加导出按钮
  - 实现批量导出多个会话
  - _需求: 10.6, 14.1, 14.2, 14.3, 14.4, 14.5_

- [ ] 26. 离线模式 - Service Worker
  - 创建service-worker.ts文件
  - 使用Workbox配置预缓存策略
  - 实现API请求的NetworkFirst策略
  - 实现静态资源的CacheFirst策略
  - 注册Service Worker
  - 实现后台同步事件监听
  - _需求: 15.1, 15.2_

- [ ] 27. 离线模式 - IndexedDB
  - 安装Dexie.js库
  - 创建AppDatabase类，定义表结构
  - 实现离线数据存储逻辑
  - 实现网络状态检测
  - 实现离线模式提示UI
  - _需求: 15.2, 15.3_

- [ ] 28. 离线数据同步
  - 实现网络恢复检测
  - 创建数据同步服务
  - 实现本地数据批量上传到Supabase
  - 实现同步冲突检测和解决
  - 显示同步进度和成功通知
  - 同步完成后清理本地缓存
  - _需求: 15.4, 15.5, 15.6_

- [ ] 29. 响应式设计实现
  - 定义CSS媒体查询断点（桌面、平板、移动）
  - 实现桌面布局（完整仪器界面）
  - 实现平板布局（简化按钮面板）
  - 实现移动布局（垂直堆叠）
  - 实现屏幕方向改变时的重新布局
  - 添加触摸手势支持（缩放、滑动）
  - _需求: 13.1, 13.2, 13.3, 13.4, 13.5_

- [ ] 30. 性能优化
  - 实现波形数据虚拟滚动
  - 使用Web Worker处理信号数据
  - 实现数据批量写入（每秒最多1次）
  - 优化Chart.js配置，减少重绘
  - 实现代码分割和懒加载
  - 压缩和优化图片资源
  - _需求: 13.6_

- [ ] 31. 错误处理系统
  - 创建ErrorHandler类
  - 实现全局错误边界
  - 实现网络错误处理（离线、超时、连接失败）
  - 实现数据验证错误处理
  - 实现业务逻辑错误处理
  - 创建Toast通知组件，显示错误消息
  - _需求: 3.5_

- [ ] 32. 国际化支持
  - 安装svelte-i18n库
  - 创建中文翻译文件（zh-CN.json）
  - 创建英文翻译文件（en-US.json）
  - 在组件中使用翻译函数
  - 实现语言切换功能
  - 添加语言选择器到设置页面
  - _需求: 无直接对应，但提升用户体验_

- [ ] 33. 可访问性改进
  - 添加ARIA标签到所有交互元素
  - 实现键盘导航支持
  - 添加焦点指示器样式
  - 确保颜色对比度符合WCAG标准
  - 为图表添加文字描述
  - 测试屏幕阅读器兼容性
  - _需求: 无直接对应，但符合工业软件标准_

- [ ]* 34. 单元测试
  - [ ]* 34.1 为SignalGenerator编写单元测试
    - 测试基础信号生成
    - 测试缺陷信号生成
    - 测试信号叠加
    - _需求: 2.1_
  - [ ]* 34.2 为信号处理服务编写单元测试
    - 测试增益调整
    - 测试滤波器
    - 测试缺陷检测算法
    - _需求: 2.1, 2.6_
  - [ ]* 34.3 为数据验证工具编写单元测试
    - 测试参数范围验证
    - 测试必填字段检查
    - _需求: 3.3, 3.5_
  - [ ]* 34.4 为Store编写单元测试
    - 测试testingStore的状态管理
    - 测试settingsStore的参数保存
    - _需求: 3.4, 4.1_

- [ ]* 35. 集成测试
  - [ ]* 35.1 测试Supabase客户端集成
    - 测试会话CRUD操作
    - 测试信号数据批量写入
    - 测试认证流程
    - _需求: 4.1, 4.2, 4.3, 11.1, 11.2_
  - [ ]* 35.2 测试组件集成
    - 测试波形图和闸门覆盖层的交互
    - 测试参数面板和波形图的联动
    - 测试数据表格和数据库的同步
    - _需求: 2.1, 3.1, 6.1, 7.3_

- [ ]* 36. E2E测试
  - [ ]* 36.1 使用Playwright编写E2E测试
    - 测试完整的检测流程（登录→开始检测→查看波形→保存数据）
    - 测试报告生成流程
    - 测试历史记录查看和导出
    - _需求: 2.1, 4.1, 9.1, 10.1_
  - [ ]* 36.2 跨浏览器测试
    - 在Chrome、Firefox、Safari上运行测试
    - 验证响应式布局
    - _需求: 13.1, 13.2, 13.3_

- [ ] 37. 部署配置
  - 创建Vercel配置文件（vercel.json）
  - 配置环境变量
  - 设置构建命令和输出目录
  - 配置域名和HTTPS
  - 设置预览环境
  - _需求: 无直接对应，但是部署必需_

- [ ] 38. 文档编写
  - 编写README.md，包含项目介绍和安装说明
  - 编写用户手册，说明各功能使用方法
  - 编写开发者文档，说明代码结构和扩展方法
  - 创建API文档，描述Supabase数据库结构
  - _需求: 无直接对应，但提升可维护性_

- [ ] 39. 最终集成和测试
  - 集成所有功能模块
  - 进行完整的端到端测试
  - 修复发现的bug
  - 优化性能瓶颈
  - 验证所有需求是否满足
  - 准备生产环境部署
  - _需求: 所有需求_
